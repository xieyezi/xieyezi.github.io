<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>react 入门必知必会知识点(万字总结✍) | xieyezi</title>
    <meta name="description" content="blog">
    <link rel="stylesheet" href="/assets/style.af18a704.css">
    <link rel="modulepreload" href="/assets/app.c6951d47.js">
    <link rel="modulepreload" href="/assets/article_react入门必知必会知识点.md.d3d3fa14.lean.js">
    
    <meta name="twitter:title" content="react 入门必知必会知识点(万字总结✍) | xieyezi">
  <meta property="og:title" content="react 入门必知必会知识点(万字总结✍) | xieyezi">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-22035cf8><div class="sidebar-button" data-v-22035cf8><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="xieyezi, back to home" data-v-22035cf8 data-v-6f1fa1d8><!----> xieyezi</a><div class="flex-grow" data-v-22035cf8></div><div class="nav" data-v-22035cf8><nav class="nav-links" data-v-22035cf8 data-v-32f7c87e><!----><!----><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item isExternal" href="https://github.com//xieyezi/vitepress-blog" target="_blank" rel="noopener noreferrer" data-v-e307cbc6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-e307cbc6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><!----><!--]--><!--]--></header><aside class="sidebar" data-v-928cb7a2><nav class="nav-links nav" data-v-928cb7a2 data-v-32f7c87e><!----><!----><div class="item" data-v-32f7c87e><div class="nav-link" data-v-32f7c87e data-v-e307cbc6><a class="item isExternal" href="https://github.com//xieyezi/vitepress-blog" target="_blank" rel="noopener noreferrer" data-v-e307cbc6>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-e307cbc6><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-928cb7a2><!--[--><li class="sidebar-link"><p class="sidebar-link-item">article</p><ul class="sidebar-links"><li class="sidebar-link"><p class="sidebar-link-item">前端</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/article/从CJS和ESM读懂package.json.html">从CJS和ESM读懂package.json</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/ES6-20个经常使用的技巧.html">ES6-20个经常使用的技巧</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/通俗易懂的学会https.html">通俗易懂的学会https</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/javascript原型与原型链的深度解析.html">javascript原型与原型链的深度解析</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/vuex5要解决哪些问题.html">vuex5要解决哪些问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/如何构建你自己的React.html">如何构建你自己的React</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/商品多规格选择-sku算法.html">商品多规格选择-sku算法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/article/react入门必知必会知识点.html">react 入门必知必会知识点(万字总结)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#组件通信">组件通信</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#props">props</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#context">Context</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#onref">OnRef</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ref">ref</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#第三方工具">第三方工具</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#路由">路由</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#react-router">react-router</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#路由组件">路由组件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#匹配组件">匹配组件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#导航组件">导航组件</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#状态管理">状态管理</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#redux">redux</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#react-redux-和-redux">react-redux 和 redux</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#connected-react-router-和-redux">connected-react-router 和 redux</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#小结一下">小结一下</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#dva">dva</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#生命周期-新旧对比">生命周期(新旧对比)</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#旧版生命周期">旧版生命周期</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#新版生命周期">新版生命周期</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#static-getderivedstatefromprops">static getDerivedStateFromProps</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#getsnapshotbeforeupdate">getSnapshotBeforeUpdate</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#版本迁移">版本迁移</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#性能优化">性能优化</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#shouldcomponentupdate">shouldComponentUpdate</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#purecomponet">PureComponet</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#memo">Memo</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#hooks">hooks</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#usestate">useState</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#useeffect">useEffect</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#useref">useRef</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usecontext">useContext</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usememo">useMemo</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#usecallback">useCallback</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义-hook">自定义 hook</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#项目配置">项目配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#总结">总结</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#参考">参考</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue3写一个疫情查询小工具.html">Vue3写一个疫情查询小工具</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/2019nCoV疫情地图.html">2019nCoV疫情地图</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/React基础知识.html">React基础知识</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/import 和 require 的区别.html">import 和 require 的区别</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/WIndows搭建最完美的VS code开发平台.html">WIndows搭建最完美的VS code开发平台</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/VueX的相关使用.html">VueX的相关使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue使用axios的get和post请求.html">Vue使用axios的get和post请求</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Tomcat的配置域名访问.html">Tomcat的配置域名访问</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue Cli3.0请求本地模拟数据.html">Vue Cli3.0请求本地模拟数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue-cli 3.0解决跨域问题.html">Vue-cli 3.0解决跨域问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue开发环境的搭建.html">Vue开发环境的搭建</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue插槽与缓存.html">Vue插槽与缓存</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue组件.html">Vue组件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue组件库iView的使用.html">Vue组件库iView的使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue路由的基本加载.html">Vue路由的基本加载</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Vue过渡与动画.html">Vue过渡与动画</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/better-scroll插件初始化后没有效果.html">better-scroll插件初始化后没有效果</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/call和apply的区别.html">call和apply的区别</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/css超出部分显示省略号.html">css超出部分显示省略号</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/nginx给tomcat配置反向代理.html">nginx给tomcat配置反向代理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/promise的连续调用问题.html">promise的连续调用问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/vue-amap的bug -Cannot read property &#39;Ac&#39; of null.html">vue-amap的bug -Cannot read property &#39;Ac&#39; of null</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/子组件和父组件通信.html">子组件和父组件通信</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/解决移动端300ms延迟点击的问题.html">解决移动端300ms延迟点击的问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/记一次自己封装NPM包的经历.html">记一次自己封装NPM包的经历</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Es6的学习笔记1.html">Es6的学习笔记1</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Es6的学习笔记2.html">Es6的学习笔记2</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Gulp的基本使用.html">Gulp的基本使用</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Git</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/article/git-flow流程.html">git-flow流程</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/git基础知识.html">git基础知识</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/git 提交规范.html">git 提交规范</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/git常用命令.html">git常用命令</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/git流程步骤.html">git流程步骤</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/删除github项目中指定目录或文件.html">删除github项目中指定目录或文件</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">笔记</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/article/继承.html">javascript的继承</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/作用域链-闭包-执行上下文.html">作用域链-闭包-执行上下文</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/一些语法块.html">一些语法块</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/防抖和节流.html">防抖和节流</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Docker</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/article/docker基础知识.html">docker基础知识</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/Dockerfile-Note.html">Dockerfile-Note</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/docker部署vue静态项目.html">docker部署vue静态项目</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/docker-compose部署项目.html">docker-compose部署项目</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">生活</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/article/2019一路走来.html">2019一路走来</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/我的2018年总结.html">我的2018年总结</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/article/2022-year-end-summary.html">2022年终总结</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-338937e7><div class="container" data-v-338937e7><!--[--><!--]--><div style="position:relative;" class="content" data-v-338937e7><div><h1 id="react-入门必知必会知识点-万字总结-✍" tabindex="-1">react 入门必知必会知识点(万字总结 ✍) <a class="header-anchor" href="#react-入门必知必会知识点-万字总结-✍" aria-hidden="true">#</a></h1><p><img src="https://i.loli.net/2020/05/30/Tl7uPjqFweDWidO.png" alt=""></p><p>笔者从去年 12 月开始接触<code>react</code>，逐步由懵逼走向熟悉。不过<code>react</code>的需要掌握的知识点可真的有点多呢。所以花了很长一段时间来整理这样一篇<code>react</code>的基础知识总结的文章，以此达到温故知新的目的。文章会涉及到<code>react</code>本身的基础知识(包括组件通讯、生命周期、路由管理、状态管理等方面)，相信你认认真真看完这篇文章以后，你会对<code>react</code>开发有个大致的了解，并且能够快速入门。这篇文章也可用作面试复习 react 基础，并且这篇文章会持续更新，小伙伴们可以点个收藏，防止迷路。废话不多说，so ,Let&#39;s go!!!</p><h2 id="组件通信" tabindex="-1">组件通信 <a class="header-anchor" href="#组件通信" aria-hidden="true">#</a></h2><h3 id="props" tabindex="-1">props <a class="header-anchor" href="#props" aria-hidden="true">#</a></h3><p>适用于父子组件通信</p><h4 id="父组件-子组件" tabindex="-1">父组件-&gt;子组件 <a class="header-anchor" href="#父组件-子组件" aria-hidden="true">#</a></h4><p>父组件将需要传递的参数通过<code>key={xxx}</code>方式传递至子组件，子组件通过<code>this.props.key</code>获取参数.</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;父组件&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>text<span class="token punctuation">&#39;</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">info</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  info<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h4 id="子组件-父组件" tabindex="-1">子组件-&gt;父组件 <a class="header-anchor" href="#子组件-父组件" aria-hidden="true">#</a></h4><p>利用 props callback 通信，父组件传递一个 callback 到子组件，当事件触发时将参数放置到 callback 带回给父组件.</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处的value便是子组件带回</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">callback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>callback<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handleChange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在此处将参数带回</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>text<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h3 id="context" tabindex="-1">Context <a class="header-anchor" href="#context" aria-hidden="true">#</a></h3><p>适用于跨层级组件之间通信</p><div class="language-tsx"><pre><code><span class="token comment">// context.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Consumer<span class="token punctuation">,</span> Provider <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//创建 context 并暴露Consumer和Provide</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> Consumer<span class="token punctuation">,</span> Provider <span class="token punctuation">}</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;info from father&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> GrandSon <span class="token keyword">from</span> <span class="token string">&quot;./grandson&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// 通过Consumer直接获取父组件的值</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件的值:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSon</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son

<span class="token comment">// 孙子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">GrandSon</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// 通过 Consumer 中可以直接获取组父组件的值</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">组父组件的值:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> GrandSon
</code></pre></div><p>特别注意</p><blockquote><p>如果需要消费多个 Context,则 React 需要使每一个 consumer 组件的 context 在组件树中成为一个单独的节点。</p></blockquote><div class="language-tsx"><pre><code><span class="token comment">// provider</span>
<span class="token operator">...</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context1.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context2.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context2.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context1.Provider</span></span><span class="token punctuation">&gt;</span></span>

 <span class="token comment">// consumer</span>
 <span class="token operator">...</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context1.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token punctuation">{</span><span class="token punctuation">(</span>info<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token comment">// 通过Consumer直接获取父组件的值</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context2.Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span>theme<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件info的值:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件theme的值:</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context2.Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context1.Consumer</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>很多优秀的 React 组件的核心功能都通过 Context 来实现的，比如 react-redux 和 react-router 等，所以掌握 Context 是必须的。</p></blockquote><h3 id="onref" tabindex="-1">OnRef <a class="header-anchor" href="#onref" aria-hidden="true">#</a></h3><p>OnRef 的原理很简单，本质上就是通过 props 将子组件的组件实例（也是我们常说的 this）当作参数，通过回调传到父组件，然后在父组件就可以拿到子组件的实例，拿到了它的实例就可以调用它的方法（<s>为所欲为</s>）了。</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  child<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">sonRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span>ref<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> ref <span class="token comment">// 在这里拿到子组件的实例</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearSonInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">clearInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">onRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>sonRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>primary<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clearSonInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          清空子组件的input
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  onRef<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component<span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onRef</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// 在这将子组件的实例传递给父组件this.props.onRef()方法</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;son&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>text<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><h3 id="ref" tabindex="-1">ref <a class="header-anchor" href="#ref" aria-hidden="true">#</a></h3><p><code>ref</code>是<code>react</code>提供给我们的一个属性,通过它，我们可以访问 <code>DOM</code> 节点或者组件.</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  son<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>son <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 在此处创建ref</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearSonInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> current <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>son <span class="token comment">// 注意，这里必须通过 this.son.current拿到子组件的实例</span>
    current<span class="token punctuation">.</span><span class="token function">clearInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>son<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>primary<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>clearSonInput<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          清空子组件的input
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;son&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">clearInput</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>text<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><blockquote><p>值得注意的是，我们必须通过 <code>this.childRef.current</code>才能拿到子组件的实例。<br> 使用 ref 常见的场景有管理焦点，文本选择或媒体播放、触发强制动画、集成第三方 DOM 库等。</p></blockquote><h3 id="第三方工具" tabindex="-1">第三方工具 <a class="header-anchor" href="#第三方工具" aria-hidden="true">#</a></h3><h4 id="events-发布订阅" tabindex="-1">events(发布订阅) <a class="header-anchor" href="#events-发布订阅" aria-hidden="true">#</a></h4><p>这种方式适用于没有任何嵌套关系的组件通信。其原理就是使用事件订阅。即是一个发布者，一个或者多个订阅者。 使用之前需要先安装:</p><div class="language-"><pre><code>yarn add events
</code></pre></div><div class="language-tsx"><pre><code><span class="token comment">// event.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> EventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;events&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 发布者 通过emit事件触发方法，发布订阅消息给订阅者</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span>
<span class="token keyword">import</span> Son2 <span class="token keyword">from</span> <span class="token string">&quot;./son2&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">&quot;./event&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  son<span class="token operator">:</span> <span class="token builtin">any</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//emit事件触发方法,通过事件名称找对应的事件处理函数info，将事件处理函数作为参数传入</span>
    emitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;我是来自father的 info&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>primary<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          点击按钮发布事件
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father

<span class="token comment">// 订阅者1</span>
<span class="token comment">// 通过emitter.addListener(事件名称,函数名)方法，进行事件监听(订阅)。</span>
<span class="token comment">// 通过emitter.removeListener(事件名称,函数名)方法 ，进行事件销毁(取消订阅)</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">&quot;./event&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Son1</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在组件挂载完成后开始监听</span>
    emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">&quot;Son1收到消息--&quot;</span> <span class="token operator">+</span> info
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 组件销毁前移除事件监听</span>
    emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">&quot;Son1即将移除事件监听--&quot;</span> <span class="token operator">+</span> info
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1

<span class="token comment">// 订阅者2</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> emitter <span class="token keyword">from</span> <span class="token string">&quot;./event&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在组件挂载完成后开始监听</span>
    emitter<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">&quot;Son2收到消息--&quot;</span> <span class="token operator">+</span> info
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 组件销毁前移除事件监听</span>
    emitter<span class="token punctuation">.</span><span class="token function">removeListener</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        info<span class="token operator">:</span> <span class="token string">&quot;Son2即将移除事件监听--&quot;</span> <span class="token operator">+</span> info
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><h2 id="路由" tabindex="-1">路由 <a class="header-anchor" href="#路由" aria-hidden="true">#</a></h2><p>随着前端工程的复杂度越来越高，所以路由管理在现在的前端工程中，也是一个值得注意的点，<code>vue</code>提供了<code>vue-router</code>来管理路由。相似的，<code>react</code>则提供了<code>react-router</code>来管理路由。</p><h3 id="react-router" tabindex="-1"><code>react-router</code> <a class="header-anchor" href="#react-router" aria-hidden="true">#</a></h3><p><code>react-router</code> 包含 <code>3</code> 个，分别为<code>react-router</code>、<code>react-router-dom</code> 和 <code>react-router-native</code>。</p><p><code>react-router</code>提供最基本的路由功能，但是实际使用的时候我们不会直接安装 <code>react-router</code>，而是根据应用运行的环境来选择安装 <code>react-router-dom</code>和<code>react-router-native</code>。因为<code>react-router-dom</code> 和 <code>react-router-native</code> 都依赖 <code>react-router</code>，所以在安装时，<code>react-router</code> 也会⾃自动安装。</p><p>其中<code>react-router-dom</code> 在浏览器器中使⽤，而<code>react-router-native</code>在 <code>react-native</code> 中使用。</p><p>在 react-router 里面，一共有 3 种基础组件，他们分别是</p><ul><li>路由组件(router components) 比如 <code>&lt;BrowserRouter&gt;</code> 和 <code>&lt;HashRouter&gt;</code></li><li>路由匹配组件(route matchers components) 比如 <code>&lt;Route&gt;</code> 和 <code>&lt;Switch&gt;</code></li><li>导航组件(navigation components) 比如 <code>&lt;Link&gt;</code>, <code>&lt;NavLink&gt;</code>, 和 <code>&lt;Redirect&gt;</code></li></ul><h3 id="路由组件" tabindex="-1">路由组件 <a class="header-anchor" href="#路由组件" aria-hidden="true">#</a></h3><p>对于 web 项目，react-roruter-dom 提供了 <code>&lt;BrowserRouter&gt;</code> 和 <code>&lt;HashRouter&gt;</code>两个路由组件。</p><ul><li><code>BrowserRouter</code>：浏览器的路由方式，也就是使用 <code>HTML5</code> 提供的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History" target="_blank" rel="noopener noreferrer"><code>history API</code></a> ( pushState , replaceState 和 popstate 事件) 来保持 <code>UI</code> 和 <code>url</code> 的同步。这种方式在<code>react</code>开发中是经常使用的路由方式，但是在打包后，打开会发现访问不了页面，所以需要通过配置 <code>nginx</code> 解决或者后台配置代理。</li><li><code>HashRouter</code>：在路径前加入#号成为一个哈希值，<code>Hash</code> 模式的好处是，再也不会因为我们刷新而找不到我们的对应路径，但是链接上面会有<code>#/</code>。在<code>vue</code>开发中，经常使用这种方式。</li></ul><p>要使用路由组件，我们只需要确保它是在根组件使用，我们应该将<code>&lt;App /&gt;</code>包裹在路由组件下面：</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-router-dom&#39;</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">&gt;</span></span>
<span class="token operator">...</span>
</code></pre></div><h3 id="匹配组件" tabindex="-1">匹配组件 <a class="header-anchor" href="#匹配组件" aria-hidden="true">#</a></h3><p>有两种路由匹配组件：<code>&lt;Route&gt;</code> 和 <code>&lt;Switch&gt;</code></p><p>这两个路由匹配组件通常在一起使用，在<code>&lt;Switch&gt;</code>里面包裹多个<code>&lt;Route&gt;</code>，然后它会逐步去比对每个<code>&lt;Route&gt;</code>的<code>path</code>属性 和浏览器当前<code>location</code>的<code>pathname</code>是否一致，如果一致则返回内容，否则返回<code>null</code>。</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">exact</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* 如果当前的URL是`/about`,即 location = { pathname: &#39;/about&#39; } ,那么About组件就应该被渲染，其余的Route就会被忽略 */</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/about<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/contact<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Contact<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>值得注意 ⚠️ 的是： <code>&lt;Route path={xxx}&gt;</code> 只会匹配 <code>URL</code>的开头，而不是整个 URL。简单的来说就是它不是精确匹配 ，例如<code>&lt;Route path =&#39;/&#39;&gt;</code> 和<code>&lt;Route path =&#39;/about&#39;&gt;</code> 它永远都只能匹配到<code>&lt;Route path =&#39;/&#39;&gt;</code>,他们开头都有&#39;/&#39;。<br> 在这里我们有两种解决方法：</p><ul><li>将此<code>&lt;Route path=&#39;/&#39;&gt;</code>放在<code>&lt;Switch&gt;</code>的最后一个位置</li><li>另一种解决方案是添加&#39;exact&#39; 实现精确匹配： <code>&lt;Route exact=&#39;/&#39;&gt;</code></li></ul><p>所以<code>&lt;Switch&gt;</code>组件只会 <code>render</code> 第一个匹配到的路由，像上面我们说的，如果没有设置 <code>path</code>，则一定会匹配，我们可以用来实现 404 的功能:</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">exact</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Home<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/about<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>About<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/contact<span class="token punctuation">&#39;</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Contact<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token punctuation">{</span><span class="token comment">/* 当上面的组件都没有匹配到的时候, 404页面 就会被 render */</span><span class="token punctuation">}</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 404页面 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="导航组件" tabindex="-1">导航组件 <a class="header-anchor" href="#导航组件" aria-hidden="true">#</a></h3><p>导航组件有<code>&lt;Link&gt;</code>, <code>&lt;NavLink&gt;</code>, 和 <code>&lt;Redirect&gt;</code>。</p><p>当我们使用<code>&lt;Link&gt;</code>的时候，在 html 页面会被渲染为一个<code>a</code>标签:</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Home</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">// &lt;a href=&#39;/&#39;&gt;Home&lt;/a&gt;</span>
</code></pre></div><p><code>&lt;NavLink&gt;</code>是一种特殊的<code>&lt;Link&gt;</code> ，当<code>&lt;NavLink&gt;</code>中的地址和浏览器地址匹配成功的时候，会添加一个 style 样式，如下：</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/about<span class="token punctuation">&#39;</span></span> <span class="token attr-name">activeClassName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>active<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  About
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 html 页面当中，它会被渲染为:</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/about<span class="token punctuation">&#39;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>active<span class="token punctuation">&#39;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  About
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>但是有时你可能想要强制跳转到某个页面，比如未登录不能进入首页，这个时候你可以使用<code>&lt;Redirect&gt;</code></p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Redirect</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>/login<span class="token punctuation">&#39;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h2 id="状态管理" tabindex="-1">状态管理 <a class="header-anchor" href="#状态管理" aria-hidden="true">#</a></h2><p>前端工程的复杂度越来越高，状态管理也是一个很重要的点。在 react 生态中，现在最火的状态管理方案就是<code>redux</code>。</p><h3 id="redux" tabindex="-1">redux <a class="header-anchor" href="#redux" aria-hidden="true">#</a></h3><p>我们都知道，react 是单向的数据流，数据几乎都是通过 props 依次从上往下传: <img src="https://i.loli.net/2020/05/25/EbvnGP2CflwQOoc.gif" alt=""></p><blockquote><p>图片来自 <a href="https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f" target="_blank" rel="noopener noreferrer">When do I know I’m ready for Redux?</a></p></blockquote><p>一个组件的状态有两种方式改变：</p><ul><li>来自父组件的 props 改变了，那么这个组件也会重新渲染</li><li>自身有 state，自身的 state 可以通过<code>this.setstate</code>方法改变</li></ul><p>现在假如我们组件树的层级比较深，有很多子组件需要共享状态，那么我们只能通过状态提升来改变状态，将状态提升到顶级父组件改变，当顶级父组件的状态改变了，那么旗下的所有子节点都会重新渲染：</p><p><img src="https://i.loli.net/2020/05/25/Po9KNkScQt1EwFR.gif" alt=""></p><p>当出现这种情况当时候，你就该使用<code>redux</code>了。那么使用<code>redux</code>之后，就会变成这样：</p><p><img src="https://i.loli.net/2020/05/25/hQO2eZsGdLa6gRq.gif" alt=""></p><p>以上 gif 动图很生动的展示了 redux 解决的问题，下面我们来介绍一下 redux 相关的知识点：</p><h4 id="store" tabindex="-1">Store <a class="header-anchor" href="#store" aria-hidden="true">#</a></h4><p>在 redux 里面，只有一个<code>Store</code>，整个应用需要管理的数据都在这个<code>Store</code>里面。这个<code>Store</code>我们不能直接去改变，我们只能通过返回一个新的<code>Store</code>去更改它。<code>redux</code>提供了一个<code>createStore</code>来创建<code>state</code></p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><h4 id="action" tabindex="-1">action <a class="header-anchor" href="#action" aria-hidden="true">#</a></h4><p>这个 <code>action</code> 指的是视图层发起的一个操作，告诉<code>Store</code> 我们需要改变。比如用户点击了按钮，我们就要去请求列表，列表的数据就会变更。每个 <code>action</code> 必须有一个 <code>type</code> 属性，这表示 <code>action</code> 的名称，然后还可以有一个 <code>payload</code> 属性，这个属性可以带一些参数，用作 <code>Store</code> 变更：</p><div class="language-ts"><pre><code><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;ADD_ITEM&quot;</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">&quot;new item&quot;</span> <span class="token comment">// 可选属性</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上面这个例子就定义了一个名为<code>ADD_ITEM</code>的<code>Action</code>，它还携带了一个<code>payload</code>的参数。 <code>Redux</code> 可以用 <code>Action Creator</code> 批量来生成一些 <code>Action</code>。</p><h4 id="reducer" tabindex="-1">reducer <a class="header-anchor" href="#reducer" aria-hidden="true">#</a></h4><p>在上面我们定义了一个<code>Action</code>,但是<code>Action</code>不会自己主动发出变更操作到<code>Store</code>，所以这里我们需要一个叫<code>dispatch</code>的东西，它专门用来发出<code>action</code>，不过还好，这个<code>dispatch</code>不需要我们自己定义和实现，<code>redux</code>已经帮我们写好了，在<code>redux</code>里面，<code>store.dispatch()</code>是 <code>View</code>发出 <code>Action</code> 的唯一方法。</p><div class="language-ts"><pre><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;ADD_ITEM&quot;</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">&quot;new item&quot;</span> <span class="token comment">// 可选属性</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当 <code>dispatch</code> 发起了一个 <code>action</code> 之后，会到达 <code>reducer</code>，那么这个 <code>reducer</code> 用来干什么呢？顾名思义，这个<code>reducer</code>就是用来计算新的<code>store</code>的，<code>reducer</code>接收两个参数：当前的<code>state</code>和接收到的<code>action</code>，然后它经过计算，会返回一个新的<code>state</code>。(前面我们已经说过了，不能直接更改<code>state</code>，必须通过返回一个新的<code>state</code>来进行变更。)</p><div class="language-ts"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个 <code>reducer</code> 是一个纯函数。纯函数的意思是说，对于相同的输入，只会有相同的输出，不会影响外部的值，也不会被外部的值所影响。纯函数属于函数式编程的概念，如果你想了解更多纯函数的概念，请看<a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch3.html#%E8%BF%BD%E6%B1%82%E2%80%9C%E7%BA%AF%E2%80%9D%E7%9A%84%E7%90%86%E7%94%B1" target="_blank" rel="noopener noreferrer">这里 </a></p><p>可以看到，我们在创建<code>store</code>的时候，我们在<code>createStore</code>里面传入了一个<code>reducer</code>参数，在这里，我们就是为了，每次<code>store.dispatch</code>发送一个新的<code>action</code>,<code>redux</code>都会自动调用<code>reducer</code>，返回新的<code>state</code>。</p><p>那么当项目特别大特别复杂的时候，<code>state</code> 肯定是非常大的一个对象，所以我们需要写很多个 <code>reducer</code>，那么在这里，我们就需要把 <code>reducer</code> 进行拆分。每个 <code>reducer</code> 只负责管理 <code>state</code> 的一部分数据。那么我们如何统一对这些 <code>reducer</code> 进行管理呢？<code>redux</code> 给我们提供了 <code>combineReducers</code> 方法，顾名思义，就是将所有的子 <code>reducer</code> 合成一个 <code>reducer</code>，方便我们管理。</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
<span class="token keyword">import</span> listReducer <span class="token keyword">from</span> <span class="token string">&quot;./listReducer/reducers&quot;</span>
<span class="token keyword">import</span> detailReducer <span class="token keyword">from</span> <span class="token string">&quot;./detailReducer/reducers&quot;</span>
<span class="token keyword">import</span> aboutReducer <span class="token keyword">from</span> <span class="token string">&quot;./aboutReducer/reducers&quot;</span>

<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  listReducer<span class="token punctuation">,</span>
  detailReducer<span class="token punctuation">,</span>
  aboutReducer
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer
</code></pre></div><h4 id="中间件" tabindex="-1">中间件 <a class="header-anchor" href="#中间件" aria-hidden="true">#</a></h4><p>熟悉<code>koa</code>的朋友们，应该知道中间件的概念。中间件的意思简单理解就是，在某两个操作之间，我们需要进行某些操作。那么在 redux,我们为什么要引入中间件呢？到目前为止，我们来捋一下我们刚刚已经进行的步骤：</p><ol><li>创建 store</li></ol><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>发出 action</li></ol><div class="language-ts"><pre><code>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;ADD_ITEM&quot;</span><span class="token punctuation">,</span>
  payload<span class="token operator">:</span> <span class="token string">&quot;new item&quot;</span> <span class="token comment">// 可选属性</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>reducer 计算返回新的 state</li></ol><div class="language-ts"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevState<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> newState<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>我们发现，我们这次发起的变更，都是同步操作，那么问题来了。假如我们<code>state</code>里面有一个列表：<code>list</code>，用户根据在<code>view</code>上面点击了一些筛选条件，发起请求，然后变更<code>state</code>里面<code>list</code>的值。在这里，有异步请求，但是我们变更 redux 的过程都是同步的，显然是不支持异步的，所以这里就用到中间件了。那么我们应该将异步请求放在以上哪个步骤去执行呢？显然第 1 步和第 3 步不可能，其中第 1 步只是在创建 <code>store</code>，第 3 步 <code>reducer</code> 是纯函数，根本不可能加入异步操作。所以我们很自然的想到，就是在 <code>store.dispatch</code> 的之后，到达<code>reducer</code>之前进行异步操作：</p><div class="language-ts"><pre><code>store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>prevAction<span class="token punctuation">)</span> async<span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;发请求啦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 异步操作执行完成之后才派发action</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 把 list 放到action里面</span>
  <span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> prevAction<span class="token punctuation">.</span>type<span class="token punctuation">,</span>
    payload<span class="token operator">:</span>list
  <span class="token punctuation">}</span>
  store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>newAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>就是给<code>store.dispatch</code>再包裹一层，这就是中间件的原理。 redux 常见的中间件有<code>redux-thunx</code>、<code>redux-promise</code>、<code>redux-saga</code>。相关的详细用法在这里不再赘述(下面会介绍<code>dva-core</code>的用法)。 redux 应用中间件的方法：</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;redux&quot;</span>
<span class="token keyword">import</span> myMiddleware <span class="token keyword">from</span> <span class="token string">&quot;./myMiddleware&quot;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>myMiddleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="通知变更" tabindex="-1">通知变更 <a class="header-anchor" href="#通知变更" aria-hidden="true">#</a></h4><p>那么到这一步了，我们变更了 <code>state</code>，下一步是将变更通知给 <code>view</code> 了。在 redux 里面，提供了<code>store.subscribe(listener)</code>这个方法,这个方法传入一个<code>listener</code>,比如在 <code>react</code> 里面，<code>listener</code>可以是<code>this.setState(xxx)</code>,每当 <code>redux</code> 里面的<code>state</code>改变了，通过<code>store.subscribe(listener)</code>我们的页面也会重新渲染。意思是我们每个页面都得手动去<code>store.subscribe(listener)</code>，这也太麻烦了吧，对吧。</p><h3 id="react-redux-和-redux" tabindex="-1"><code>react-redux</code> 和 <code>redux</code> <a class="header-anchor" href="#react-redux-和-redux" aria-hidden="true">#</a></h3><p>为了解决上述的痛点问题，更好的将 <code>redux</code> 和 <code>react</code> 结合，官方给我们提供了<code>react-redux</code>这个包（可能你到现在脑子有点乱了，我刚开始也是）。那么现在，我们需要明确一个概念：<code>redux</code> 和 <code>react</code> 是两个八竿子不着的人。<code>redux</code> 只是一个状态管理框架，<code>react</code> 只是一个前端应用框架。<code>redux</code> 可以用于前端任何框架，例如 <code>vue</code>，甚至纯 <code>javaScript</code> 都可以。后来 <code>react-redux</code> 出现了，他把 <code>redux</code> 和 <code>react</code> 撮合在一起了，于是他们两强强联合，风云合璧，所向披靡，好了不扯了。说了这么多就是想说明 <code>react-redux</code> 这个包的作用。</p><p>在详细说明<code>react-redux</code>的作用之前，我们先介绍以下知识点： <code>react-redux</code>将 react 组件划分为<code>容器组件</code>和<code>展示组件</code>，其中</p><ul><li>展示组件：只是负责展示 UI，不涉及到逻辑的处理，数据来自父组件的<code>props</code>;</li><li>容器组件：负责逻辑、数据交互，将 state 里面的数据传递给<code>展示组件</code>进行 UI 呈现</li></ul><p>容器组件是<code>react-redux</code>提供的，也就是说，我们只需要负责展示组件，<code>react-redux</code>负责状态管理。</p><p>我们知道，<code>redux</code>提供了一个大的<code>state</code>。这里我们需要面对两个问题，第一个问题，如何让我们<code>react</code>项目里面的所有组件都能够拿到<code>state</code>？；第二个，每当<code>state</code>变更之后，组件如何收到变更信息？</p><h5 id="provider" tabindex="-1"><code>Provider</code> <a class="header-anchor" href="#provider" aria-hidden="true">#</a></h5><p>针对第一个问题，<code>react-redux</code>提供了<code>Provider</code>组件。用这个<code>Provider</code>包裹根组件，将<code>redux</code>导出的<code>state</code>，作为参数往下面传</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这个store由redux导出</span>
···
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
···
<span class="token keyword">return</span>
</code></pre></div><p>这样所有的组件都能拿到<code>state</code>了。这个 Provider 组件原理就是通过<code>react</code>的<code>Context</code>来实现的，我们可以看看源码:</p><div class="language-tsx"><pre><code><span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> Context <span class="token operator">=</span> context <span class="token operator">||</span> ReactReduxContext<span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Context.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>contextValue<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Context.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
</code></pre></div><p>这里的<code>contextValue</code>就包裹了我们传入的<code>store</code>，很明显，它创建了 Context，通过<code>&lt;Context.Provider value={contextValue}&gt;{children}&lt;/Context.Provider&gt;</code>这种方式将我们传入的<code>store</code>提供给了<code>react</code>所有组件。</p><h5 id="connect" tabindex="-1"><code>connect</code> <a class="header-anchor" href="#connect" aria-hidden="true">#</a></h5><p>在上面我们知道怎么将 redux 暴露出来的 state 提供给 react 组件的，那么接下来，我们在某个子组件里面如何收到 state 的变更呢？<code>react-redux</code>给我们提供了<code>connect</code>方法。这个方法可以传入两个可选参数:<code>mapStateToProps</code>和<code>mapDispatchToProps</code>，然后会返回一个容器组件，这个组件可以自动监听到 <code>state</code> 的变更，将 <code>state</code> 的值映射为组件的 <code>props</code> 参数，之后我们可以直接通过 <code>this.props</code> 取到 <code>state</code> 里面的值。</p><div class="language-tsx"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> state<span class="token punctuation">.</span>goodsList<span class="token punctuation">,</span>
  totalCount<span class="token operator">:</span> state<span class="token punctuation">.</span>totalCount<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span> <span class="token comment">// 可选</span>
<span class="token comment">// mapDispatchToProps, // 可选</span>
<span class="token punctuation">(</span>GoodsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>mapStateToProps</code>就是将 state 的值映射为组件的<code>props</code>，<code>mapDispatchToProps</code>就是将<code>store.dispatch</code>映射为<code>props</code>。如果我们不传<code>mapDispatchToProps</code>的话，<code>connect</code>会自动将 <code>dispatch</code> 注入到 <code>props</code> 里面，我们在组件里可以直接通过<code>this.props.dispatch</code>发起一个<code>action</code>给<code>reducer</code>。</p><h3 id="connected-react-router-和-redux" tabindex="-1"><code>connected-react-router</code> 和 <code>redux</code> <a class="header-anchor" href="#connected-react-router-和-redux" aria-hidden="true">#</a></h3><p>当我们在项目中同时用了<code>react-router</code> 和 <code>redux</code>的时候，我们可以把他们两个深度整合。我们想要在<code>store</code>里面拿到<code>router</code>，甚至可以操作<code>router</code>，还可以记录<code>router</code>的改变。例如我们把用户是否登录的状态存在<code>redux</code>里面，在登录之后会进行页面的跳转。正常的操作是我们在发起请求之后，得到一个状态，此时我们需要<code>dispatch</code>一个<code>action</code>去改变<code>redux</code>的状态，同时我们需要进行路由的跳转，类似于这样:<code>store.dispatch(replace(&#39;/home&#39;))</code>。想要实现这种深度整合，我们需要用到 <code>connected-react-router</code>和<code>history</code>两个库。</p><p>首先需要<code>history</code>生成<code>history</code>对象，结合<code>connected-react-router</code>的<code>connectRouter</code>生成<code>routerReducer</code>，同时利用<code>connected-react-router</code>的<code>routerMiddleware</code>实现<code>dispatch action</code>导航，也就是我们刚刚说的<code>store.dispatch(replace(&#39;/home&#39;))</code>:</p><div class="language-tsx"><pre><code><span class="token comment">// APP.tsx</span>
<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;history&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">export</span> <span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// reducer/index.ts</span>
<span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> middleware <span class="token operator">=</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span>
</code></pre></div><p>接着利用<code>redux</code>的<code>combineReducers</code>将我们自己的<code>reducer</code>和<code>routerReducer</code>合并起来，组成<code>rootReducer</code>，然后利用 <code>createStore</code>创建<code>store</code>并暴露出去:</p><div class="language-tsx"><pre><code><span class="token comment">// reducer/index.ts</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> middleware <span class="token operator">=</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span>
  <span class="token comment">//合并routerReducer</span>
  <span class="token keyword">const</span> rootRuder <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    info<span class="token operator">:</span> infoRuder<span class="token punctuation">,</span>
    router<span class="token operator">:</span> routerReducer
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootRuder<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token operator">...</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> store
<span class="token punctuation">}</span>
</code></pre></div><p>最后我们在<code>App.tsx</code>导入刚刚我们创建的这个方法，生成<code>store</code>,接着将我们创建的<code>history</code>对象传入<code>connected-react-router</code>的<code>ConnectedRouter</code>组件作为<code>props</code>，并用它包裹我们的<code>Router</code>组件:</p><div class="language-tsx"><pre><code><span class="token comment">// App.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConnectedRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;connected-react-router&quot;</span>
<span class="token keyword">import</span> geneGrateSotore <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span>

<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;history&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>

<span class="token keyword">const</span> f<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectedRouter</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Router</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConnectedRouter</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> f
</code></pre></div><p>这样我们就将<code>connected-react-router</code> 和 <code>redux</code>整合起来了。现在当我们在<code>View</code>利用<code>Link</code>进行路由跳转的时候，会通过<code>react-router-dom</code>进行路由跳转，并且也会通过<code>connected-react-router</code>发起一个<code>action</code>去更新<code>redux state</code>里面的<code>router</code>对象，以记录路由的变化。同时现在我们在状态管理的时候，也可以直接通过<code>connected-react-router</code>提供的<code>push</code>、<code>replace</code>等方法了，他们是从 <code>redux</code> 出发，也就是说先发起一个<code>action</code>，然后再进行路由跳转。</p><h3 id="小结一下" tabindex="-1">小结一下 <a class="header-anchor" href="#小结一下" aria-hidden="true">#</a></h3><p>看了上面的这些东西，是不是感觉脑子贼乱，什么<code>react</code>、<code>redux</code>、<code>react-redux</code>、<code>react-router</code>、<code>react-router-dom</code>、<code>connected-react-router</code>，这些概念是真的多，我刚开始接触的时候直接看懵逼。。所以 react 的可组合性比 vue 高很多，所以说 vue 真的是自动挡、react 是手动挡。但是我们只需记住，前端的一切概念，都是纸老虎而已。静下心来捋一捋，很快就理解了。好了，现在来看看这个图：</p><p><img src="https://i.loli.net/2020/05/30/MvhzTLqPCjSlgF4.png" alt=""></p><p>结合上面介绍的知识点，把思路捋顺，咱们再继续 💪</p><h3 id="dva" tabindex="-1">dva <a class="header-anchor" href="#dva" aria-hidden="true">#</a></h3><p>通过上面的这些工具，我们已经可以搭建一个很棒的基于<code>react</code>和<code>redux</code>的工程。如果单纯使用<code>redux</code>，当项目越来越大的时候，我们的<code>redux</code>的操作也会变得繁杂，代码和文件的组织会变得臃肿,我们就必须把<code>action</code>、<code>reducer</code>、<code>createActions</code>、<code>actionType</code>等等文件放在不同的目录下面，当我们需要使用的时候，就要打开文件目录去翻半天，我们需要在这些文件里面不停切换，简直抓狂。所以我们不禁会想：要是所有的操作都放在一个文件该多好！没错，它来了。它就是<code>dva</code>。</p><blockquote><p>dva 首先是一个基于 redux 和 redux-saga 的数据流方案，然后为了简化开发体验，dva 还额外内置了 react-router 和 fetch，所以也可以理解为一个轻量级的应用框架。</p></blockquote><p>因为我们前面已经自己组织了<code>react-router</code>，所以我们只使用<code>dva-core</code>,有了这个，我们就可以将 <code>reducers</code>, <code>effects</code> 等等组织在一个<code>model</code>文件里面了。以前我们组织代码的方式是<code>createAction.ts</code>、<code>actionType.ts</code>、<code>reducer/xxx.ts</code>,但是通过<code>dva</code>，我们就可以把这些都写在一个文件里面。接下来我们来看看如何配置<code>dva-core</code>:</p><p>首先我们需要通过<code>dva create</code>暴露一个<code>dva app</code>:</p><div class="language-tsx"><pre><code><span class="token comment">// dva/index.tsx</span>

<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> create <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;dva-core&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  options<span class="token punctuation">.</span>models<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>model<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> app<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">)</span>
  app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> app<span class="token punctuation">.</span>_store
  app<span class="token punctuation">.</span><span class="token function-variable function">start</span> <span class="token operator">=</span> <span class="token punctuation">(</span>container<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>container<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">}</span>
  app<span class="token punctuation">.</span><span class="token function-variable function">getStore</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> store

  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre></div><p>上面的 <code>options</code> 即是我们的 <code>model</code> 文件。然后我们需要利用这个 <code>app</code> 重新配置我们的 <code>store</code>:</p><div class="language-ts"><pre><code><span class="token comment">/// store/index.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connectRouter<span class="token punctuation">,</span> routerMiddleware <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;connected-react-router&quot;</span>
<span class="token keyword">import</span> dva <span class="token keyword">from</span> <span class="token string">&quot;./dva&quot;</span>
<span class="token keyword">import</span> models <span class="token keyword">from</span> <span class="token string">&quot;../models&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> routerReducer <span class="token operator">=</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> routerMiddlewareForDispatch <span class="token operator">=</span> <span class="token function">routerMiddleware</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    models<span class="token punctuation">,</span>
    initState<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    extraReducers<span class="token operator">:</span> <span class="token punctuation">{</span> router<span class="token operator">:</span> routerReducer <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onAction<span class="token operator">:</span> <span class="token punctuation">[</span>routerMiddlewareForDispatch<span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> app
<span class="token punctuation">}</span>
</code></pre></div><p>然后一样的，我们在<code>App.tsx</code>使用它即可:</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConnectedRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;connected-react-router&quot;</span>
<span class="token keyword">import</span> geneGrateSotore <span class="token keyword">from</span> <span class="token string">&quot;./store&quot;</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">&quot;./router&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./App.css&quot;</span>

<span class="token keyword">const</span> createHistory <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;history&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>createBrowserHistory
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">geneGrateSotore</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span>
<span class="token keyword">const</span> f<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span> <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectedRouter</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConnectedRouter</span></span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> f
</code></pre></div><p>这和之前配置 <code>redux</code> 对比起来，我们已经省了很多的文件了，我们的 <code>store</code> 文件清净多了。下面我们要来编写<code>model</code>文件了。例如有个模块叫<code>model1</code>:</p><div class="language-ts"><pre><code><span class="token comment">// model/model1.ts</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> namespace <span class="token operator">=</span> <span class="token string">&quot;model1&quot;</span>
<span class="token keyword">interface</span> <span class="token class-name">IDvaState</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> state<span class="token operator">:</span> IDvaState <span class="token operator">=</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token string">&quot;init info1&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> model1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  namespace<span class="token punctuation">,</span>
  state<span class="token punctuation">,</span>
  effects<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">*</span><span class="token function">changeInfo1</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> payload
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">&quot;setState&quot;</span><span class="token punctuation">,</span>
          payload<span class="token operator">:</span> <span class="token punctuation">{</span> info1<span class="token operator">:</span> text <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-empty</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">setState</span><span class="token punctuation">(</span>state<span class="token operator">:</span> IDvaState<span class="token punctuation">,</span> <span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>payload <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>model1<span class="token punctuation">]</span>
</code></pre></div><p>这个文件可能有的小伙伴一下子看不明白，接下来我们来一起捋一捋。</p><ul><li><code>namespace</code>: 命名空间(我们组件可以通过这个 <code>namespace</code> 拿到我们的 <code>model</code>,从而取值和进行操作)</li><li><code>state</code>:这个就是我们需要管理的状态(存放状态的地方)</li><li><code>effects</code>：一些操作，我们可以把同步操作和异步操作都放到<code>effects</code>里面,简单来说就是我们的业务逻辑。这里会详细介绍，咱们先明白它是做什么的</li><li><code>reducers</code>: <code>reducer</code>这个概念就是跟<code>redux</code>的<code>reducer</code>是同一个意思(返回一个<code>newState</code>，更新<code>state</code>) 好了有了上面这些概念，接下来我们来看看如何把组件和<code>model</code>联系起来。</li></ul><div class="language-tsx"><pre><code><span class="token comment">// home.tsx</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> namespace <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/model1&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Home</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function-variable function">changeFormHome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> dispatch <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/changeInfo1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">&quot;从Home改变的info1&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是home页</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeFormHome<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> home点击更改redux</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  info1<span class="token operator">:</span> model<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>info1
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>看了上面的代码，你是不是瞬间理解了，咱们还是通过<code>react-redux</code>的<code>connect</code>来获取<code>model</code>的，只不过我们通过<code>namespace</code>指定了具体是哪个<code>model</code>。到目前为止，咱们已经知道，组件如何从<code>model</code>里面取值。那么我们在组件里面如何改变 <code>model</code>里面的 <code>state</code> 呢？</p><p>现在我们的<code>home.tsx</code>页面上有一个按钮，点击这个按钮会<code>dispatch</code>一个<code>action</code>:</p><div class="language-ts"><pre><code><span class="token operator">...</span>
 <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/changeInfo1</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> <span class="token string">&#39;从Home改变的info1&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><p>可以看到，这个 action 的 type 为我们的<code>model/effects/changeInfo1</code>。看到这里相信你已经理解得差不多了，对的，就是通过 <code>dispatch</code> 一个和 <code>effects</code> 里面的一个同名方法，即可找到 <code>effects</code> 对应的方法。<br> 接下来到<code>effect</code>对应的<code>changeInfo1</code>看看是如何改变 state。</p><div class="language-ts"><pre><code><span class="token operator">...</span>
 <span class="token operator">*</span><span class="token function">changeInfo1</span><span class="token punctuation">(</span><span class="token punctuation">{</span> payload <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> put <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> payload
        <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          type<span class="token operator">:</span> <span class="token string">&#39;setState&#39;</span><span class="token punctuation">,</span>
          payload<span class="token operator">:</span> <span class="token punctuation">{</span> info1<span class="token operator">:</span> text <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// eslint-disable-next-line no-empty</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">...</span>

</code></pre></div><p>我们通过 <code>put</code> ,发起了一个<code>action</code>,到最终的<code>reducer</code>，其中的<code>payload</code>来自我们传入的<code>text</code>，然后<code>state</code>被修改了，同时页面也刷新了:</p><p><img src="https://i.loli.net/2020/06/04/m1JxqcrCbWSNTBu.gif" alt=""></p><p>除了<code>put</code>,还有<code>call</code>(用于发起异步请求)、<code>select</code>(用于取出 <code>state</code> 里面的值)，都是<code>redux-saga</code>提供的，这里不过多叙述，具体使用的方法请查阅<a href="https://redux-saga-in-chinese.js.org/" target="_blank" rel="noopener noreferrer">redux-saga</a>文档。</p><p>我这里整理了两个图，对比<code>redux</code>和<code>dva</code>的流程操作：</p><p><img src="https://i.loli.net/2020/06/05/uNZ15WxQFyTDUEf.png" alt=""></p><p><img src="https://i.loli.net/2020/06/05/ea5dk7nSy3XrM4w.png" alt=""></p><p>简单总结一下：<code>dva</code> 把 <code>action -&gt; reducer</code> 拆分成了，<code>action -&gt; model(reducer, effect)</code>我们在写业务的时候，再也不用到处去找我们的<code>reducer</code>、<code>action</code>了。<code>dva</code>真的给我们提供了极大的便利。</p><h2 id="生命周期-新旧对比" tabindex="-1">生命周期(新旧对比) <a class="header-anchor" href="#生命周期-新旧对比" aria-hidden="true">#</a></h2><h3 id="旧版生命周期" tabindex="-1">旧版生命周期 <a class="header-anchor" href="#旧版生命周期" aria-hidden="true">#</a></h3><p>旧版生命周期 指的是 React 16.3 及其之前的版本。</p><p><img src="https://i.loli.net/2020/05/13/qxlU1hO2zeYKBiJ.png" alt=""></p><p>请看下面两段代码</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span><span class="token string">&#39;parent info&#39;</span>
  <span class="token punctuation">}</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化默认的状态对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span><span class="token string">&#39;parent life&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1. constructor 初始化 props 和 state&#39;</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;2. componentWillMount 组件将要挂载&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//一般在componentDidMount执行副作用，如异步请求</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;4. componentDidMount 组件挂载完成&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//异步请求</span>
  <span class="token punctuation">}</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span>nextState<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;5. shouldComponentUpdate 询问组件是否需要更新, 返回true则更新，否则不更新&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;6. componentWillUpdate 组件将要更新&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;7. componentDidUpdate 组件更新完毕&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token builtin">number</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3.render渲染&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> info <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props
      <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info<span class="token punctuation">}</span><span class="token plain-text">:</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeName<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">更改name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token attr-name">parentName</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    )
  }
}
export default Parent

// 子组件
import React, </span><span class="token punctuation">{</span> Component <span class="token punctuation">}</span><span class="token plain-text"> from &#39;react&#39;
class Son extends Component </span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      info<span class="token operator">:</span> <span class="token string">&#39;son info&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Son componentWillUnmount 组件将要挂载&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//调用此方法的时候会把新的属性对象和新的状态对象传过来</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>parentName <span class="token operator">!==</span> <span class="token string">&#39;parent info&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//componentWillReceiveProp 组件收到新的属性对象</span>
  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1.Son组件 componentWillReceiveProps&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39; 2.Son组件 render&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>parentName<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token plain-text">
export default Son
</span></code></pre></div><blockquote><p>react 父子组件的渲染顺序遵循<code>洋葱模型</code></p></blockquote><h3 id="新版生命周期" tabindex="-1">新版生命周期 <a class="header-anchor" href="#新版生命周期" aria-hidden="true">#</a></h3><p><img src="https://i.loli.net/2020/05/28/J9iDekbThNFI1Gc.png" alt=""></p><h3 id="static-getderivedstatefromprops" tabindex="-1">static getDerivedStateFromProps <a class="header-anchor" href="#static-getderivedstatefromprops" aria-hidden="true">#</a></h3><ul><li><code>static getDerivedStateFromProps(nextProps,prevState)</code>：接收父组件传递过来的 <code>props</code> 和组件之前的状态，返回一个对象来更新 <code>state</code> 或者返回 <code>null</code> 来表示接收到的 <code>props</code> 没有变化，不需要更新 state.</li><li>该生命周期钩子的作用： 将父组件传递过来的 props 映射 到子组件的 <code>state</code> 上面，这样组件内部就不用再通过 <code>this.props.xxx</code> 获取属性值了，统一通过 <code>this.state.xxx</code> 获取。映射就相当于拷贝了一份父组件传过来的 <code>props</code> ，作为子组件自己的状态。注意：子组件通过 <code>setState</code> 更新自身状态时，不会改变父组件的 <code>props</code></li><li>配合 <code>componentDidUpdate</code>，可以覆盖 <code>componentWillReceiveProps</code> 的所有用法</li><li>该生命周期钩子触发的时机：</li></ul><ol><li>在 React 16.3.0 版本中：在组件实例化、接收到新的 <code>props</code> 时会被调用</li><li>在 React 16.4.0 版本中：在组件实例化、接收到新的 <code>props</code> 、组件状态更新时会被调用</li></ol><div class="language-tsx"><pre><code>	<span class="token comment">// 根据新的属性对象派生状态对象</span>
  <span class="token comment">// nextProps:新的属性对象 prevState:旧的状态对象</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>nextprops<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;props&#39;</span><span class="token punctuation">,</span>nextprops<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回一个对象来更新 state 或者返回 null 来表示接收到的 props 不需要更新 state</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>parentName <span class="token operator">!==</span> <span class="token string">&#39;parent info&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        info<span class="token operator">:</span> nextprops<span class="token punctuation">.</span>parentName<span class="token punctuation">,</span>
        <span class="token comment">// 注意：这里不需要把组件自身的状态也放进来</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="getsnapshotbeforeupdate" tabindex="-1">getSnapshotBeforeUpdate <a class="header-anchor" href="#getsnapshotbeforeupdate" aria-hidden="true">#</a></h3><ul><li><code>getSnapshotBeforeUpdate(prevProps</code>, <code>prevState</code>)：接收父组件传递过来的 <code>props</code> 和组件之前的状态，此生命周期钩子必须有返回值，返回值将作为第三个参数传递给 <code>componentDidUpdate</code>。必须和 <code>componentDidUpdate</code> 一起使用，否则会报错。</li><li>该生命周期钩子触发的时机 ：被调用于 <code>render</code> 之后、更新 <code>DOM</code> 和 <code>refs</code> 之前</li><li>该生命周期钩子的作用： 它能让你在组件更新 <code>DOM</code> 和 <code>refs</code> 之前，从 <code>DOM</code> 中捕获一些信息（例如滚动位置）</li><li>配合 <code>componentDidUpdate</code>, 可以覆盖 <code>componentWillUpdate</code> 的所有用法</li><li>demo：每次组件更新时，都去获取之前的滚动位置，让组件保持在之前的滚动位置</li></ul><div class="language-tsx"><pre><code> <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回更新内容的高度</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> prevScrollHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// 在这里拿到高度</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span>
      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>wrapper<span class="token punctuation">.</span>current<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> prevScrollHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="版本迁移" tabindex="-1">版本迁移 <a class="header-anchor" href="#版本迁移" aria-hidden="true">#</a></h3><ul><li><code>componentWillMount</code>，<code>componentWillReceiveProps</code>，<code>componentWillUpdate</code> 这三个生命周期因为经常会被误解和滥用，所以被称为 不安全（不是指安全性，而是表示使用这些生命周期的代码，有可能在未来的 <code>React</code> 版本中存在缺陷，可能会影响未来的异步渲染） 的生命周期。</li><li>React 16.3 版本：为不安全的生命周期引入别名 <code>UNSAFE_componentWillMount</code>，<code>UNSAFE_componentWillReceiveProps</code> 和 <code>UNSAFE_componentWillUpdate</code>。（旧的生命周期名称和新的别名都可以在此版本中使用）</li><li>React 16.3 之后的版本：为 <code>componentWillMount</code>，<code>componentWillReceiveProps</code> 和 <code>componentWillUpdate</code> 启用弃用警告。（旧的生命周期名称和新的别名都可以在此版本中使用，但旧名称会记录 DEV 模式警告）。</li></ul><blockquote><p>此段总结均来自<a href="https://juejin.im/post/5df648836fb9a016526eba01" target="_blank" rel="noopener noreferrer">你真的了解 React 生命周期吗</a></p></blockquote><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-hidden="true">#</a></h2><p>我们都知道，react 是数据驱动视图的变化，即是通过<code>reder</code>来渲染视图，当数据(即状态)变化时，我们的页面就应当重新渲染。但是应用复杂之后就会出现这种情况：一个父组件 A 下面包含了多个子组件 B、C、D。假如 B、C 组件用到了父组件 A 的某个属性，子组件 D 却没有用到这个属性，当父组件的这个属性改变的时候，他下面的子组件 B、C 组件重新渲染，但是子组件 D 本不需要重新渲染，但是他没办法，他也被重新渲染了。这就造成了性能浪费了。说这么多，不如我们来看个例子：</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span>
<span class="token keyword">import</span> Son2 <span class="token keyword">from</span> <span class="token string">&quot;./son2&quot;</span>
<span class="token keyword">import</span> Son3 <span class="token keyword">from</span> <span class="token string">&quot;./son3&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Istate</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Istate<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">&quot;info1&quot;</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">&quot;info2&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">&quot;info1被改变了...&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Parent

<span class="token comment">// 子组件1</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info1<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son1</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;son1重新渲染了....&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是son1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info1<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1

<span class="token comment">// 子组件2</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;son2重新渲染了....&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>上面这个例子，父组件提供了两个值：<code>info1</code> 和 <code>info2</code>，其中 <code>Son1</code> 组件只用到了 <code>info1</code>，<code>Son2</code> 组件只用到了 <code>info2</code>。我们在父组件中，点击了按钮改变了 <code>info1</code> 的值，父组件必须重新渲染，因为它自身状态改变了，<code>Son1</code> 也应该重新渲染，因为它依赖于 <code>info1</code>，而 <code>Son2</code> 是否应该重新渲染呢？按道理，它不应该重新渲染，因为 <code>info2</code> 没有改变，但是当我们每次点击按钮改变 <code>info1</code> 的时候，<code>Son1</code> 和<code>Son2</code> 都重新渲染了，这就明显存在问题了。</p><h3 id="shouldcomponentupdate" tabindex="-1">shouldComponentUpdate <a class="header-anchor" href="#shouldcomponentupdate" aria-hidden="true">#</a></h3><p>在上面 👆 生命周期章节，我们讲到了<code>shouldComponentUpdate</code>这个生命周期钩子，它接收两个参数，一个是下一次的 <code>props</code> 和下一次的 <code>state</code>，在这里，我们拿到下一次的 <code>props</code>(<code>nextProps</code>)和当前的 <code>props</code> 进行比较，根据我们的场景，返回一个 <code>bool</code> 变量，返回 <code>true</code>，则表示要更新当前组件，返回 <code>false</code> 则表示不更新当前组件。</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// 利用生命周期 shouldComponentUpdate 进行比较</span>
  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token operator">:</span> Iprops<span class="token punctuation">,</span> nextState<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>info2 <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;son2重新渲染了....&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>当我们再次点击按钮更改<code>info1</code>的值，发现<code>Son2</code>就不会再重新渲染了。</p><h3 id="purecomponet" tabindex="-1">PureComponet <a class="header-anchor" href="#purecomponet" aria-hidden="true">#</a></h3><p><code>react</code>为我们提供了<code>PureComponet</code>的语法糖，用它也可以用作组件是否渲染的比较。它的原理就是内部实现了<code>shouldComponentUpdate</code>。让我们用<code>PureComponet</code>来改造一下刚刚的<code>Son2</code>组件:</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Son2</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent<span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;son2重新渲染了....&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是son2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son2
</code></pre></div><p>再次点击按钮改变<code>info1</code>的值，发现<code>Son2</code>也不会渲染了。</p><p>虽然<code>PureComponent</code>帮我们很好的实现了<code>shouldComponentUpdate</code>，但是它也是有缺点的。它只能用作对象的浅层比较，也就是它只会进行一层比较，当我们的数据是嵌套的对象或者数组的时候，它就无法比较了。所以<code>PureComponent</code>最好只用于<code>展示型组件</code>。</p><p>除了以上缺点以外，<code>PureComponent</code>还有一些另外值得我们注意的地方：</p><p>当我们给<code>PureComponent</code>包裹的子组件传入一个<code>立即执行函数</code>的时候，父组件的状态改变的时候，这个子组件始终会重新渲染：</p><div class="language-tsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>这个问题的出现是因为 <code>change</code> 这个函数每次都会执行，所以导致 <code>Son2</code> 组件每次都会重新渲染。这个问题的解决方法很简单，有两种方法：</p><ul><li>第一种，将这个立即执行函数，抽取到类方法上，并且在<code>constructor</code> bind <code>this</code>:</li></ul><div class="language-tsx"><pre><code><span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>change <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">change</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">&#39;info1&#39;</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">&#39;info2&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">&#39;info1被改变了...&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

</code></pre></div><ul><li>第二种，利用箭头函数将立即函数抽取成类属性：</li></ul><div class="language-tsx"><pre><code>state<span class="token operator">:</span> Istate <span class="token operator">=</span> <span class="token punctuation">{</span>
    info1<span class="token operator">:</span> <span class="token string">&#39;info1&#39;</span><span class="token punctuation">,</span>
    info2<span class="token operator">:</span> <span class="token string">&#39;info2&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">info1Change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      info1<span class="token operator">:</span> <span class="token string">&#39;info1被改变了...&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>info1Change<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">info1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info1<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token attr-name">info2</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info2<span class="token punctuation">}</span></span> <span class="token attr-name">change</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="memo" tabindex="-1">Memo <a class="header-anchor" href="#memo" aria-hidden="true">#</a></h3><p>刚刚我们介绍了<code>PureComponent</code>，但是这只是用于<code>class</code>组件，当我们用函数组件时，<code>react</code> 也给我们提供了一种方式：<code>memo</code></p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  info2<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son3<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;son3重新渲染了....&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是Son3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>info2<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>Son3<span class="token punctuation">)</span>
</code></pre></div><p>不过使用 memo 的时候也有<code>PureComponent</code>的限制，我们仍然需要注意。</p><p>看到了这里，肯定很多同学都在问，hooks 哪去了？别急呢，马上就来 👇</p><h2 id="hooks" tabindex="-1">hooks <a class="header-anchor" href="#hooks" aria-hidden="true">#</a></h2><p>随着<code>react 16.8</code>版本的出现，<code>hooks</code>也问世了。<code>hooks</code>解决了<code>class</code>组件饱受诟病的众多问题，比如绑定<code>this</code>的问题、组件的逻辑复用的问题等等。其实起初我对<code>hooks</code>并不十分感冒，因为那个时候笔者连<code>class</code>写法都还没掌握，再学个这玩意简直徒增烦恼。后来没办法，团队里的小伙伴都开始使用<code>hooks</code>，所以我也被动学习了一波。这不写不知道，一写就真香！！！所以赶紧学起来吧</p><h3 id="usestate" tabindex="-1">useState <a class="header-anchor" href="#usestate" aria-hidden="true">#</a></h3><p>记住一个点，<code>useState</code>返回两个参数，一个是<code>state</code>(也就是我们的<code>state</code>)、一个是用于更新<code>state</code>的函数。其实你叫啥名都行，不过咱们为了给 hooks 一个标志，大多采用如下写法：</p><div class="language-ts"><pre><code><span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initState<span class="token punctuation">)</span>
</code></pre></div><p>好了，掌握这个就行了，我们来使用一下：(别忘记了，我们现在只需要写函数式组件了哦)</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;init info&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setinfo</span><span class="token punctuation">(</span><span class="token string">&quot;改变info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>当我们初次进入 <code>home</code> 页面时，页面上会显示 <code>info</code> 的初始值：<code>init info</code>，然后当我们点击按钮，调用 <code>setInfo</code>,然后 <code>info</code> 的值就被改变了。就是这么简单。</p><h3 id="useeffect" tabindex="-1">useEffect <a class="header-anchor" href="#useeffect" aria-hidden="true">#</a></h3><p><code>useEffect</code> 其实只比复杂了那么一点。它合成了 <code>calss</code> 组件中的<code>componentDidMount</code>、<code>componentDidUpdate</code>、 <code>componentWillUnmount</code>。 我们很容易就明白，它是用来执行副作用的，最最常见的副作用就是异步请求。</p><p>下面我们用它来实现<code>class</code>组件的<code>componentDidMount</code>的用法:</p><div class="language-tsx"><pre><code><span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取商品列表</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法发起异步请求</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">&quot;flex&quot;</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">&quot;row&quot;</span><span class="token punctuation">,</span> justifyContent<span class="token operator">:</span> <span class="token string">&quot;space-around&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>example<span class="token punctuation">&#39;</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>上面的<code>getList</code>就是咱们发起异步请求的方法，我们在<code>useEffect</code>里面使用了它，同时我们还传入了一个<code>[]</code>,就表示我们只需在页面初始化的时候发起请求，这样使用就相当于<code>class</code>组件的<code>componentDidMount</code>。</p><p>接下来我们再来实现<code>class</code>组件的<code>componentDidUpdate</code>的用法:</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Card <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> namespace <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/model1&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;init info&quot;</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取商品列表</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是home页</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token string">&quot;改变info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">&quot;flex&quot;</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">&quot;row&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>example<span class="token punctuation">&#39;</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><p>看上面，我们希望点击按钮时改变 <code>info</code> 时，它会自动再去发起请求，从而刷新页面(也就是说，<code>goodsList</code> 的数据依赖于 <code>info</code>)。可以看见，我们这里还是利用了<code>useEffect</code>的第二个参数，只不过这次我们传入的是<code>[info]</code>，意思就是告诉<code>useEffect</code>，如果 <code>info</code> 的值发生改变了，就去发起请求。这相当于我们在<code>class</code>组件的<code>componentDidMount</code>钩子。</p><p>接下来还有最后一个<code>class</code>组件的<code>componentWillUnmount</code>的用法了。这个就更简单了，我们只需要在<code>useEffect</code> <code>return</code> 一个回调函数，就可以用来清除上一次副作用留下的副作用了:</p><div class="language-tsx"><pre><code><span class="token operator">...</span><span class="token punctuation">.</span>
 <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/clearData</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">...</span><span class="token punctuation">.</span>

</code></pre></div><h3 id="useref" tabindex="-1">useRef <a class="header-anchor" href="#useref" aria-hidden="true">#</a></h3><p>这个<code>hook</code>更简单了，它就是用来拿到子组件的实例的，相当于<code>class</code>组件的<code>React.createRef()</code>：</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react-redux&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Card <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> namespace <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../models/model1&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./components/son&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  dispatch<span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> dispatch<span class="token punctuation">,</span> goodsList <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> sonRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 在这里新建一个子组件的ref</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;init info&quot;</span><span class="token punctuation">)</span>

  <span class="token comment">// 获取商品列表</span>
  <span class="token keyword">const</span> <span class="token function-variable function">getList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    conson<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sonRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token comment">// 在这里就可以通过sonRef拿到子组件</span>
    <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">namespace</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/getGoodsList</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">我是home页</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token string">&quot;改变info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> 点击更改info</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> display<span class="token operator">:</span> <span class="token string">&quot;flex&quot;</span><span class="token punctuation">,</span> flexDirection<span class="token operator">:</span> <span class="token string">&quot;row&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>goodsList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token attr-name">hoverable</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">240</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token attr-name">cover</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>example<span class="token punctuation">&#39;</span></span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Card</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>model<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  goodsList<span class="token operator">:</span> model<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>goodsList
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>Home<span class="token punctuation">)</span>
</code></pre></div><h3 id="usecontext" tabindex="-1">useContext <a class="header-anchor" href="#usecontext" aria-hidden="true">#</a></h3><p><code>useContext</code>这个<code>hook</code>的作用也很简单，它可以让我们在函数组件中使用<code>Context</code>，而且它还解决了以前我们需要利用<code>Consumer</code>包裹组件的问题：</p><div class="language-tsx"><pre><code><span class="token comment">// context.js</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> Consumer <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">//创建 context 并暴露Provider和Consumer</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> Provider<span class="token punctuation">,</span> Consumer <span class="token punctuation">}</span>

<span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">&quot;./son&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  state <span class="token operator">=</span> <span class="token punctuation">{</span>
    info<span class="token operator">:</span> <span class="token string">&quot;info from father&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>info<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Father
</code></pre></div><p>在 <code>class</code> 组件里面，我们要想拿到 Context 里面的值，必须通过 <code>Consumer</code> 包裹组件：</p><div class="language-tsx"><pre><code><span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Consumer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./context&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
          <span class="token comment">// 通过Consumer直接获取父组件的值</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件的值:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Consumer</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><p>有了 <code>useContext</code>，就只需要这样:</p><div class="language-tsx"><pre><code><span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span>
funcion <span class="token function">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">父组件的值:</span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son
</code></pre></div><p>我们可以看到上面直接使用 <code>React.useContext(Context)</code> 就可以获得 <code>context</code>，而在之前的版本中需要像这样才能获取 <code>&lt;Consumer&gt;({vlaue} =&gt; {})&lt;/Consumer&gt;</code> ，这极大的简化了代码的书写。</p><h3 id="usememo" tabindex="-1">useMemo <a class="header-anchor" href="#usememo" aria-hidden="true">#</a></h3><p>先来看看官网给出的用法：</p><div class="language-ts"><pre><code><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>根据官网的解释和这个用法可以看出，在 <code>a</code> 和 <code>b</code> 的变量值不变的情况下，<code>memoizedValue</code>的值不变。即是：<code>useMemo</code>函数的第一个入参函数不会被执行，从而达到节省计算量的目的（有点像<code>vue</code>的计算属性）。那它有什么用呢？通常来说可以用作性能优化的手段。我们来看一个例子：</p><div class="language-tsx"><pre><code><span class="token comment">// 父组件</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">onVisible</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home

<span class="token comment">// 子组件</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onVisible</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son1<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onVisible <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我被重新渲染了....&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">button</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Son1
</code></pre></div><p>在父组件中，有个<code>Input</code>输入框,每次输入新的值，父组件的<code>info</code>的值就会发生改变，同时我们发现子组件每次都会重新渲染，即使我们子组件没用到<code>info</code>的值，那是因为<code>setInfo</code>导致父组件重新渲染了，也导致<code>onVisible</code>每次都变成一个新的值，所以引起子组件重新渲染。那么有的同学就会说，可以利用<code>React.memo</code>，我们来试一试:</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> memo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onVisible</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> Son1<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> onVisible <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;我被重新渲染了....&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">onVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">button</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">memo</span><span class="token punctuation">(</span>Son1<span class="token punctuation">)</span>
</code></pre></div><p>然后我们随便在输入框输入新的值，我们发现，子组件仍然会重新渲染，为什么呢？那是因为这里的<code>props.onVisible</code>是一个函数，它是一个引用类型的值，当父组件重新渲染<code>onVisible</code> 这个函数也会重新生成,这样引用地址变化就导致对比出新的数据,子组件就会重新渲染。所以我们需要缓存<code>onVisible</code>这个函数，即是：我们只需要创建一遍这个函数，以后父组件重新渲染的时候，<code>onVisible</code>的值仍然是第一次渲染的值，这样子组件才不会重新渲染。这个时候我们就用到了<code>useMemo</code>：</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> Son1 <span class="token keyword">from</span> <span class="token string">&quot;./son1&quot;</span>

<span class="token keyword">interface</span> <span class="token class-name">Iprops</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> onVisible <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>可以看到，我们利用<code>useMemo</code>将<code>onVisible</code>缓存起来了,我们在<code>useMemo</code>的第二个参数传入了一个<code>[]</code>，表明它只会在渲染时执行一次，这里的用法跟<code>useEffect</code>一样，<code>[]</code>传入依赖项，当依赖项改变时，我们缓存的值才会重新计算。再次在输入框输入新的值，我们发现子组件不渲染了。</p><blockquote><p><code>useMemo</code> 一般用于计算比较复杂的场景</p></blockquote><h3 id="usecallback" tabindex="-1">useCallback <a class="header-anchor" href="#usecallback" aria-hidden="true">#</a></h3><p>如果掌握了<code>useMemo</code>，那掌握 <code>useCallback</code>简直不在话下。我们先来看看定义:</p><div class="language-ts"><pre><code><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>在 <code>a</code>和<code>b</code> 的变量值不变的情况下，<code>memoizedCallback</code> 的引用不变。即：<code>useCallback</code> 的第一个入参函数会被缓存，从而达到渲染性能优化的目的。是不是跟<code>useMemo</code>很像？<code>useMemo</code>是缓存值，<code>useCallback</code>一个是缓存函数的引用。也就是说 <code>useCallback(fn, [deps])</code> 相当于 <code>useMemo(() =&gt; fn, [deps])</code>。我们现在用 <code>useCallback</code> 来改造一下刚刚上面 👆 那个例子:</p><div class="language-tsx"><pre><code>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Iprops<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>info<span class="token punctuation">,</span> setInfo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token comment">// const onVisible = useMemo(() =&gt; {</span>
  <span class="token comment">//   return () =&gt; {</span>
  <span class="token comment">//     setVisible((visible) =&gt; !visible)</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }, [])</span>
  <span class="token keyword">const</span> onVisible <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span>visible <span class="token operator">=&gt;</span> <span class="token operator">!</span>visible<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token function">setInfo</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&#39;5px&#39;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&#39;400px&#39;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&#39;400px&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>info<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">changeInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Input</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token attr-name">onVisible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onVisible<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>我相信你肯定已经看懂了，什么？没看懂？那再看一遍！</p><h3 id="自定义-hook" tabindex="-1">自定义 hook <a class="header-anchor" href="#自定义-hook" aria-hidden="true">#</a></h3><p>借助于<code>react</code>提供的基础<code>hook</code>,我们通常也可以自定义<code>hook</code>，<code>react</code>规定我们自定义<code>hook</code>时，必须以<code>use</code>开头。我们来尝试自定义一个控制对话框的<code>hook</code>:</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span>

<span class="token keyword">type</span> <span class="token class-name">returnd</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>visible<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">]</span>

<span class="token keyword">const</span> useVisible <span class="token operator">=</span> <span class="token punctuation">(</span>initVisible <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token operator">:</span> returnd <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initVisible<span class="token punctuation">)</span>
  <span class="token keyword">function</span> <span class="token function">onVisible</span><span class="token punctuation">(</span>value<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> newValue <span class="token operator">=</span> value <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token operator">!</span>visible <span class="token operator">:</span> value
    <span class="token function">setVisible</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> onVisible<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useVisible
</code></pre></div><p>首先我们利用<code>useState</code>声明了<code>visible</code>和<code>setVisible</code>,然后我们定义了<code>onVisible</code>这个函数用来更改<code>visible</code>，接着我们返回<code>[visible, onVisible]</code>。然后我们来看看如何使用：</p><div class="language-tsx"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Button<span class="token punctuation">,</span> Modal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;antd&quot;</span>
<span class="token keyword">import</span> useVisible <span class="token keyword">from</span> <span class="token string">&quot;../hooks/useVisible&quot;</span>

<span class="token keyword">const</span> Home<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">modalShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setVisible</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token operator">:</span> <span class="token string">&quot;5px&quot;</span><span class="token punctuation">,</span> marginLeft<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span><span class="token punctuation">,</span> marginRight<span class="token operator">:</span> <span class="token string">&quot;400px&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>primary<span class="token punctuation">&#39;</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        Open Modal
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#39;</span>Basic Modal<span class="token punctuation">&#39;</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span></span> <span class="token attr-name">onOk</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">modalShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Some contents...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Home
</code></pre></div><p>就像我们使用其他<code>hook</code>一样方便。我们在写业务(搬砖)的过程中，我们可以尝试去将一些可复用的逻辑或者操作封装为我们自己的<code>hook</code>，这才是<code>hooks</code>的强大之处。</p><h2 id="项目配置" tabindex="-1">项目配置 <a class="header-anchor" href="#项目配置" aria-hidden="true">#</a></h2><p>我们在开发<code>react</code>的时候，不免需要一些配置，例如别名、跨域等等。<code>vue</code>给我们提供了一个<code>vue.config.js</code>用于配置，那么<code>react</code>项目呢？我们需要用到<code>react-app-rewired</code>和<code>customize-cra</code>:</p><div class="language-js"><pre><code>yarn add react<span class="token operator">-</span>app<span class="token operator">-</span>rewired <span class="token operator">-</span><span class="token constant">D</span>
yarn add customize<span class="token operator">-</span>cra <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>安装完之后，我们需要更改一下我们的<code>package.json</code>文件：</p><div class="language-json"><pre><code>....
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired start&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-app-rewired test --env=jsdom&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-scripts eject&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
....
</code></pre></div><p>接着我们需要在项目的根目录新建一个<code>config-overrides.js</code>文件。接下来我们对项目进行一些配置：</p><div class="language-js"><pre><code><span class="token comment">/* config-overrides.js */</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> override<span class="token punctuation">,</span> addWebpackResolve<span class="token punctuation">,</span> fixBabelImports<span class="token punctuation">,</span> overrideDevServer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;customize-cra&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> addReactRefresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;customize-cra-react-refresh&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 配置开发环境跨域</span>
<span class="token keyword">const</span> <span class="token function-variable function">devServerConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>config<span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;/mock/158/airi&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&quot;https://api.guaik.org&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">webpack</span><span class="token operator">:</span> <span class="token function">override</span><span class="token punctuation">(</span>
    <span class="token comment">// 热加载</span>
    <span class="token function">addReactRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置路径别名</span>
    <span class="token function">addWebpackResolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;@&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// antd 按需加载</span>
    <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">&quot;import&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">libraryName</span><span class="token operator">:</span> <span class="token string">&quot;antd&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">libraryDirectory</span><span class="token operator">:</span> <span class="token string">&quot;es&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token function">overrideDevServer</span><span class="token punctuation">(</span><span class="token function">devServerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>更多的配置请查看这里:<a href="https://github.com/arackaf/customize-cra/blob/master/api.md" target="_blank" rel="noopener noreferrer">customize-cra</a></p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-hidden="true">#</a></h2><p><code>react</code> 的知识点真的很多，对不？本文只是一个入门概览，还有很多很多的知识点，希望小伙伴们通过这篇文章对 <code>react</code> 有个大致了解，这篇文章也可以作为面试复习基础知识的笔记，笔者花了两周时间，整理了这样一篇<code>react</code>入门的文章,写到这里已经凌晨 1 点，如果你觉得这篇文章对你有所帮助，那就点个赞吧 ❤️</p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><p>1、<a href="https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f" target="_blank" rel="noopener noreferrer">https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f</a></p><p>2、<a href="https://juejin.im/post/5c18de8ef265da616413f332" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5c18de8ef265da616413f332</a></p><p>3、<a href="https://juejin.im/post/5dcaaa276fb9a04a965e2c9b" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5dcaaa276fb9a04a965e2c9b</a></p><p>4、<a href="https://juejin.im/post/5dbbdbd5f265da4d4b5fe57d" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5dbbdbd5f265da4d4b5fe57d</a></p><p>5、<a href="https://github.com/monsterooo/blog/issues/37" target="_blank" rel="noopener noreferrer">https://github.com/monsterooo/blog/issues/37</a></p><p>6、<a href="https://github.com/monsterooo/blog/issues/28" target="_blank" rel="noopener noreferrer">https://github.com/monsterooo/blog/issues/28</a></p></div></div><footer class="page-footer" data-v-338937e7 data-v-4b207065><div class="edit" data-v-4b207065><div class="edit-link" data-v-4b207065 data-v-76b066b8><a class="link" href="https://github.com//xieyezi/vitepress-blog/edit/main/docs/article/react入门必知必会知识点.md" target="_blank" rel="noopener noreferrer" data-v-76b066b8>帮助我改进此内容？ <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-76b066b8><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-4b207065><!----></div></footer><div class="next-and-prev-link" data-v-338937e7 data-v-19df4348><div class="container" data-v-19df4348><div class="prev" data-v-19df4348><a class="link" href="/article/商品多规格选择-sku算法" data-v-19df4348><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-19df4348><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-19df4348>商品多规格选择-sku算法</span></a></div><div class="next" data-v-19df4348><a class="link" href="/article/Vue3写一个疫情查询小工具" data-v-19df4348><span class="text" data-v-19df4348>Vue3写一个疫情查询小工具</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-19df4348><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"article_2019ncov疫情地图.md\":\"327eaf66\",\"article_2022-year-end-summary.md\":\"2b86064b\",\"article_dockerfile-note.md\":\"b587bcaf\",\"article_es6-20个经常使用的技巧.md\":\"a435d56a\",\"article_es6的学习笔记1.md\":\"7fc93df2\",\"article_es6的学习笔记2.md\":\"388ad895\",\"article_gulp的基本使用.md\":\"b1c4941a\",\"article_readme.md\":\"105cdfe9\",\"article_react基础知识.md\":\"e2d6446c\",\"article_tomcat的配置域名访问.md\":\"275db6c4\",\"article_vue cli3.0请求本地模拟数据.md\":\"1ddf76e3\",\"article_vue-cli 3.0解决跨域问题.md\":\"be504869\",\"article_vue3写一个疫情查询小工具.md\":\"f5f9201f\",\"article_vuex的相关使用.md\":\"631e8a27\",\"article_vue使用axios的get和post请求.md\":\"ac047a19\",\"article_vue开发环境的搭建.md\":\"8ca5addc\",\"article_vue插槽与缓存.md\":\"2e88814b\",\"article_vue组件.md\":\"65a4574f\",\"article_vue组件库iview的使用.md\":\"3f9ffbda\",\"article_vue路由的基本加载.md\":\"83e3bfef\",\"article_vue过渡与动画.md\":\"ce3ac20d\",\"article_windows搭建最完美的vs code开发平台.md\":\"e05c292b\",\"article_better-scroll插件初始化后没有效果.md\":\"2640ecb7\",\"article_call和apply的区别.md\":\"035e7554\",\"article_css超出部分显示省略号.md\":\"8ad62768\",\"article_docker-compose部署项目.md\":\"180c569b\",\"article_docker部署vue静态项目.md\":\"2c98bf66\",\"article_git 提交规范.md\":\"a48ef569\",\"article_git-flow流程.md\":\"918b9f66\",\"article_git常用命令.md\":\"fb4fba9f\",\"article_git流程步骤.md\":\"11acc0cc\",\"article_import 和 require 的区别.md\":\"2741a4dd\",\"article_javascript原型与原型链的深度解析.md\":\"8d2285b8\",\"article_nginx给tomcat配置反向代理.md\":\"5ce23543\",\"article_promise的连续调用问题.md\":\"f82e561d\",\"article_react入门必知必会知识点.md\":\"d3d3fa14\",\"article_vue-amap的bug -cannot read property 'ac' of null.md\":\"717e59da\",\"article_vuex5要解决哪些问题.md\":\"70763e33\",\"article_一些语法块.md\":\"352d8b72\",\"article_从cjs和esm读懂package.json.md\":\"cb5bcbc1\",\"article_作用域链-闭包-执行上下文.md\":\"774e4bb3\",\"article_删除github项目中指定目录或文件.md\":\"a9545558\",\"article_原型与原型链.md\":\"82c4d75e\",\"article_商品多规格选择-sku算法.md\":\"4d1f819e\",\"article_子组件和父组件通信.md\":\"12adcfc6\",\"article_我的2018年总结.md\":\"90dbe43a\",\"article_有趣的闭包.md\":\"657fdd8d\",\"article_继承.md\":\"c9d655fa\",\"article_解决移动端300ms延迟点击的问题.md\":\"521314b9\",\"article_记一次自己封装npm包的经历.md\":\"005b09f4\",\"article_通俗易懂的学会https.md\":\"78f8586e\",\"article_防抖和节流.md\":\"f071a824\",\"index.md\":\"0dad21c8\",\"index_cn.md\":\"a01a77dc\"}")</script>
    <script type="module" async src="/assets/app.c6951d47.js"></script>
    
  </body>
</html>